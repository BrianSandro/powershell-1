Get-Mailbox -ResultSize unlimited | ForEach {Get-MobileDeviceStatistics -Mailbox:$_.Identity} | where {$_.LastSuccessSync -lt (Get-Date).AddDays("-30") -Or $_.DeviceAccessState -eq 'Quarantined'} | ForEach {Remove-MobileDevice ([string]$_.Guid) -confirm:$false}